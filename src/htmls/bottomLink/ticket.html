<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ticket</title>

    <link rel="stylesheet" href="../../css/ticket.css">
    <link rel="stylesheet" href="../../css/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css">
</head>
<body class="noselect">
    <div id="topBar">
        淘宝券
    </div>

<!-- 上导航栏开始 -->
    <div id="navBarAll">
        <div id="navBar">
            <ul name="0">
                <li name="0">ifashion</li>
                <li name="1">女装</li>
                <li name="2">男装</li>
                <li name="3">零食小吃</li>
                <li name="4">珠宝配饰</li>
                <li name="5">美妆</li>
                <li name="6">母婴</li>
                <li name="7">内衣</li>
                <li name="8">鞋包</li>
                <li name="9">数码配件</li>
                <li name="10">家装</li>
                <li name="11">家居用品</li>
                <li name="12">家电</li>
                <li name="13">汽车</li>
                <li name="14">生活服务</li>
                <li name="15">图书音像</li>
                <li name="16">游戏话费</li>
                <li name="17">其他</li>
            </ul>
        </div>
    </div>
    
<!-- 上导航栏结束 -->

<!-- 中间主要显示内容开始 -->
    <div id="content">
        <figure id="full_feature" class="swipslider">
            <ul class="sw-slides">
                <li class="sw-slide" name="0">
                    <div id="imgPlay">
                        <img src="../../images/shopClassify/woman/show1.jpg" alt="">
                    </div>
                    <div class="mold">
                        <div class="moldLeft"><img src="../../images/shopClassify/woman/show2.jpg" alt=""></div>
                        <div class="moldRight">
                            <div class="moldRightTop"><img src="../../images/shopImg/m(2).jpg" alt=""></div>
                            <div class="moldRightBottom">
                                <div class="moldRightBottomLeft"><img src="../../images/shopClassify/woman/show3.jpg" alt=""></div>
                                <div class="moldRightBottomRight"><img src="../../images/shopImg/m(4).jpg" alt=""></div>
                            </div>
                        </div>
                    </div>
                    <div id="moddleBar">
                        <ul>
                            <li>推荐</li>
                            <li>最新</li>
                            <li>销量</li>
                        </ul>
                    </div>
                    <div class="shopList">
                        <ul>
                        </ul>
                        <div class="loading">正在加载中···</div>
                    </div>
                </li>
                <li class="sw-slide" name="1">
                    <div id="moddleBar">
                        <ul>
                            <li>推荐</li>
                            <li>最新</li>
                            <li>销量</li>
                        </ul>
                    </div>
                    <div class="shopList">
                        <ul>
                        </ul>
                    </div>
                </li>       
                <li class="sw-slide" name="2">
                    <div id="moddleBar">
                        <ul>
                            <li>推荐</li>
                            <li>最新</li>
                            <li>销量</li>
                        </ul>
                    </div>
                    <div class="shopList">
                        <ul>
                        </ul>
                    </div>
                </li>
                <li class="sw-slide" name="3">
                    <div id="moddleBar">
                        <ul>
                            <li>推荐</li>
                            <li>最新</li>
                            <li>销量</li>
                        </ul>
                    </div>
                    <div class="shopList">
                        <ul>
                        </ul>
                    </div>
                </li>
                <li class="sw-slide" name="4">
                    <div id="moddleBar">
                        <ul>
                            <li>推荐</li>
                            <li>最新</li>
                            <li>销量</li>
                        </ul>
                    </div>
                    <div class="shopList">
                        <ul>
                        </ul>
                    </div>
                </li>
                <li class="sw-slide" name="5">
                    <div id="moddleBar">
                        <ul>
                            <li>推荐</li>
                            <li>最新</li>
                            <li>销量</li>
                        </ul>
                    </div>
                    <div class="shopList">
                        <ul>
                        </ul>
                    </div>
                </li>
                <li class="sw-slide" name="6">
                    <div id="moddleBar">
                        <ul>
                            <li>推荐</li>
                            <li>最新</li>
                            <li>销量</li>
                        </ul>
                    </div>
                    <div class="shopList">
                        <ul>
                        </ul>
                    </div>
                </li>       
                <li class="sw-slide" name="7">
                    <div id="moddleBar">
                        <ul>
                            <li>推荐</li>
                            <li>最新</li>
                            <li>销量</li>
                        </ul>
                    </div>
                    <div class="shopList">
                        <ul>
                        </ul>
                    </div>
                </li>
                <li class="sw-slide" name="8">
                    <div id="moddleBar">
                        <ul>
                            <li>推荐</li>
                            <li>最新</li>
                            <li>销量</li>
                        </ul>
                    </div>
                    <div class="shopList">
                        <ul>
                        </ul>
                    </div>
                </li>
                <li class="sw-slide" name="9">
                    <div id="moddleBar">
                        <ul>
                            <li>推荐</li>
                            <li>最新</li>
                            <li>销量</li>
                        </ul>
                    </div>
                    <div class="shopList">
                        <ul>
                        </ul>
                    </div>
                </li>
                <li class="sw-slide" name="10">
                    <div class="shopList">
                        <ul>
                        </ul>
                    </div>
                </li>
                <li class="sw-slide" name="11">
                    <div id="moddleBar">
                        <ul>
                            <li>推荐</li>
                            <li>最新</li>
                            <li>销量</li>
                        </ul>
                    </div>
                    <div class="shopList">
                        <ul>
                        </ul>
                    </div>
                </li>
                <li class="sw-slide" name="12">
                    <div id="moddleBar">
                        <ul>
                            <li>推荐</li>
                            <li>最新</li>
                            <li>销量</li>
                        </ul>
                    </div>
                    <div class="shopList">
                        <ul>
                        </ul>
                    </div>
                </li>
                <li class="sw-slide" name="13">
                    <div id="moddleBar">
                        <ul>
                            <li>推荐</li>
                            <li>最新</li>
                            <li>销量</li>
                        </ul>
                    </div>
                    <div class="shopList">
                        <ul>
                        </ul>
                    </div>
                </li>
                <li class="sw-slide" name="14">
                    <div id="moddleBar">
                        <ul>
                            <li>推荐</li>
                            <li>最新</li>
                            <li>销量</li>
                        </ul>
                    </div>
                    <div class="shopList">
                        <ul>
                        </ul>
                    </div>
                </li>
                <li class="sw-slide" name="15">
                    <div id="moddleBar">
                        <ul>
                            <li>推荐</li>
                            <li>最新</li>
                            <li>销量</li>
                        </ul>
                    </div>
                    <div class="shopList">
                        <ul>
                        </ul>
                    </div>
                </li>
                <li class="sw-slide" name="16">
                    <div id="moddleBar">
                        <ul>
                            <li>推荐</li>
                            <li>最新</li>
                            <li>销量</li>
                        </ul>
                    </div>
                    <div class="shopList">
                        <ul>
                        </ul>
                    </div>
                </li>
                <li class="sw-slide" name="17">
                    <div id="moddleBar">
                        <ul>
                            <li>推荐</li>
                            <li>最新</li>
                            <li>销量</li>
                        </ul>
                    </div>
                    <div class="shopList">
                        <ul>
                        </ul>
                    </div>
                </li>
            </ul>
        </figure>
    </div>
<!-- 中间主要显示内容结束 -->
</body>
<script src="../../js/jquery.js"></script>
<script src="../../js/ticket.js"></script>
<script type="text/javascript">
    $(window).load(function() {
        $('#full_feature').swipeslider();


        var liNum = 1;
        var nowObj = $(".sw-slides li:eq(0)");
        var shopCount = new Array(10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10);
        var liId;
        var getRequest = true;
        getData(0);

        $(".sw-slides>li").scroll(function(){
            nowObj = $(this);
            var tempHeight = this.scrollHeight - $(this).scrollTop() - $(this).height();
            if(tempHeight < 50 && getRequest){
                getData($(this).attr("name"),shopCount[$(this).attr("name")]);
                shopCount[$(this).attr("name")] += 10;
                getRequest = false;
            }
        });
        
        function getData(id,page = 0){ //获取商品信息
            $.ajax({
                url:'../../../control/entrance.php',
                type:'post',
                dataType:'json',
                data:{
                    flag:"get",
                    str:"classifyShop",
                    id:id,
                    page:page
                },
                success:function(data){
                    //console.log(shopCount);
                    $.each(data,function(n,val){
                        nowObj.children(".shopList").children("ul").append(initData(val));
                    });

                    
                    if(liNum <= 17){
                        liId = ".sw-slides>li:eq(" + liNum + ")";
                        nowObj = $(liId);

                        getData(liNum);
                        liNum++;
                    }

                    getRequest = true;
                },
                error(error){
                    console.log(error);
                }
            });
        }
        function initData(data){            
            var html = '<li>' +
                            '<div class="shopImg"><a href="javascript:void(0)" onclick="openIframe(\'src/htmls/otherLink/shopinfo.html?id=' + data['ShopId'] + '\')"><img src="' + data['ShopImgUrl'] + '" alt=""></a></div>' +
                            '<div class="shopInfo">' +
                                '<a href="javascript:void(0)" onclick="openIframe(\'src/htmls/otherLink/shopinfo.html?id=' + data['ShopId'] + '\')"><p class="shopTitle">' + data['ShopName'] + '</p></a>' +
                                '<div class="shopCard"><span>' + data['CardPrice'] + '</span></div>' +
                                '<p class="shopPrePrice">原价：' + data['ShopPrice'] + '</p>' +
                                '<p class="shopAftPrice">￥' + (data['ShopPrice'] - parseInt(data['CardPrice'].substr(data['CardPrice'].indexOf("减") + 1))).toFixed(2) + '</p>' +
                            '</div>' +
                        '</li>';

            return html;
        }
    });
    function openIframe(src){
        window.parent.$("#newWindow").attr("src",src).animate({
            left:'-100%'
        },300);
    }
</script>
</html>